<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Allometry database harmonization • traits4models</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Allometry database harmonization">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">traits4models</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Data preparation</h6></li>
    <li><a class="dropdown-item" href="../articles/TraitDatabaseHarmonization.html">Trait database harmonization</a></li>
    <li><a class="dropdown-item" href="../articles/AllometryDatabaseHarmonization.html">Allometry database harmonization</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Building species parameter tables</h6></li>
    <li><a class="dropdown-item" href="../articles/SpeciesParameterizationMEDFATE.html">Building species parameter tables for medfate</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/traits4models/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Allometry database harmonization</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres / Nicolas Martin-StPaul</h4>
            
            <h4 data-toc-skip class="date">2025-06-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/traits4models/blob/HEAD/vignettes/AllometryDatabaseHarmonization.Rmd" class="external-link"><code>vignettes/AllometryDatabaseHarmonization.Rmd</code></a></small>
      <div class="d-none name"><code>AllometryDatabaseHarmonization.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The availability of plant allometric equations continuously
increases, as additional efforts are made in observational studies. This
means that multiple data sources need to be harmonized before species
parameter tables are build, in terms of:</p>
<pre><code>a) Nomenclature of the response and predictor variables.
b) Allometric equation fitted.
c) Taxonomy of the measured biological entities. </code></pre>
<p>The result of this harmonization needs to be stored in a harmonized
format for subsequent use when creating species parameter tables. This
vignette illustrates the harmonization procedures for an example data
set using package <strong>trait4models</strong> and the usual
<strong>tidyverse</strong> packages. Harmonization of plant trait data
is explained in a companion vignette.</p>
<div class="section level3">
<h3 id="required-packages">Required packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>Assuming we have <strong>traits4models</strong> installed, we load it
and other common packages that we will employ in this vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/traits4models/">traits4models</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-dataset">Example dataset<a class="anchor" aria-label="anchor" href="#example-dataset"></a>
</h3>
<p>As an example of allometric equations, we will use a small
compilation of crown width models, from different sources, that depend
on diameter at breast height:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DB_path</span> <span class="op">&lt;-</span> <span class="st">"~/OneDrive/EMF_datasets/AllometryDatabases/"</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"Sources/TreeAllometries/TreeAllometries.xlsx"</span><span class="op">)</span>,</span>
<span>                                 sheet<span class="op">=</span> <span class="st">"Tree_CW_models"</span><span class="op">)</span></span></code></pre></div>
<p>The data looks as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span></span></code></pre></div>
<pre><code><span><span class="co">##                 Name      a_cw   b_cw                           Source</span></span>
<span><span class="co">## 1         Abies alba 1.0963648 0.5380    Hasenauer (1997) - Abies alba</span></span>
<span><span class="co">## 2               Acer 1.5189207 0.5285     Hasenauer (1997) - Acer spp.</span></span>
<span><span class="co">## 3    Castanea sativa 1.3065630 0.5856             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 4    Fagus sylvatica 0.8386180 0.7347             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 5           Fraxinus 1.1951838 0.5665 Hasenauer (1997) - Fraxinus spp.</span></span>
<span><span class="co">## 6   Pinus halepensis 0.6415296 0.7310             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 7        Pinus nigra 0.5076312 0.7699             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 8     Pinus pinaster 0.3889517 0.8307             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 9      Pinus radiata 0.8418950 0.6353             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 10  Pinus sylvestris 0.7474409 0.6716             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 11     Quercus ilex  0.5681897 0.7974             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 12 Quercus pyrenaica 0.7469926 0.7257             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 13     Quercus robur 0.0716000 0.6563             Condés &amp; Sterba 2005</span></span>
<span><span class="co">## 14     Quercus suber 0.4473000 0.7918     Sánchez-Gonzalez et al. 2007</span></span>
<span><span class="co">## 15             Pinus 0.7474409 0.6716                 Pinus sylvestris</span></span>
<span><span class="co">## 16           Quercus 0.5681897 0.7974                           Q.ilex</span></span>
<span><span class="co">## 17             Abies 1.0963648 0.5380                       Abies alba</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="harmonizing-equations-and-notation">Harmonizing equations and notation<a class="anchor" aria-label="anchor" href="#harmonizing-equations-and-notation"></a>
</h2>
<p>The allometric equation has two parameters that are used to estimate
crown width from diameter at breast height (DBH). We start our
harmonization by subsetting the necessary data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_var</span> <span class="op">&lt;-</span> <span class="va">db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>originalName <span class="op">=</span> <span class="st">"Name"</span>,</span>
<span>                a <span class="op">=</span> <span class="st">"a_cw"</span>,</span>
<span>                b <span class="op">=</span> <span class="st">"b_cw"</span>,</span>
<span>                Reference <span class="op">=</span> <span class="st">"Source"</span><span class="op">)</span> </span></code></pre></div>
<p>Importantly, for the allometry to be used, we need to specify the
equation:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_var</span> <span class="op">&lt;-</span> <span class="va">db_var</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Equation <span class="op">=</span> <span class="st">"CrownWidth = a·DBH^b"</span><span class="op">)</span></span></code></pre></div>
<p>We also add information on the response variable and predictor
variable:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_var</span> <span class="op">&lt;-</span> <span class="va">db_var</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Response <span class="op">=</span> <span class="st">"CrownWidth"</span>,</span>
<span>                ResponseDescription <span class="op">=</span> <span class="st">"Crown width (m)"</span>,</span>
<span>                Predictor1 <span class="op">=</span> <span class="st">"DBH"</span>,</span>
<span>                PredictorDescription1 <span class="op">=</span> <span class="st">"Diameter at breast height (cm)"</span><span class="op">)</span></span></code></pre></div>
<p>If we want <strong>traits4models</strong> to correctly interpret the
allometric equation at the stage of model parameter filling, it is
important that columns <code>Equation</code> and <code>Response</code>
are appropriately filled. Note, in addition, that the allometric
equation starts with the name of the response on the left hand side of
the equation.</p>
<p>Finally, we may add the priority of processing:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_var</span> <span class="op">&lt;-</span> <span class="va">db_var</span> <span class="op">|&gt;</span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Priority <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">Reference</span>, .after <span class="op">=</span> <span class="va">PredictorDescription1</span><span class="op">)</span></span></code></pre></div>
<p>The database after harmonizing allometry information looks as
follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_var</span></span></code></pre></div>
<pre><code><span><span class="co">##         originalName         a      b             Equation   Response</span></span>
<span><span class="co">## 1         Abies alba 1.0963648 0.5380 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 2               Acer 1.5189207 0.5285 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 3    Castanea sativa 1.3065630 0.5856 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 4    Fagus sylvatica 0.8386180 0.7347 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 5           Fraxinus 1.1951838 0.5665 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 6   Pinus halepensis 0.6415296 0.7310 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 7        Pinus nigra 0.5076312 0.7699 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 8     Pinus pinaster 0.3889517 0.8307 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 9      Pinus radiata 0.8418950 0.6353 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 10  Pinus sylvestris 0.7474409 0.6716 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 11     Quercus ilex  0.5681897 0.7974 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 12 Quercus pyrenaica 0.7469926 0.7257 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 13     Quercus robur 0.0716000 0.6563 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 14     Quercus suber 0.4473000 0.7918 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 15             Pinus 0.7474409 0.6716 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 16           Quercus 0.5681897 0.7974 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 17             Abies 1.0963648 0.5380 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">##    ResponseDescription Predictor1          PredictorDescription1</span></span>
<span><span class="co">## 1      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 2      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 3      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 4      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 5      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 6      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 7      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 8      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 9      Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 10     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 11     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 12     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 13     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 14     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 15     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 16     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 17     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">##                           Reference Priority</span></span>
<span><span class="co">## 1     Hasenauer (1997) - Abies alba        1</span></span>
<span><span class="co">## 2      Hasenauer (1997) - Acer spp.        1</span></span>
<span><span class="co">## 3              Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 4              Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 5  Hasenauer (1997) - Fraxinus spp.        1</span></span>
<span><span class="co">## 6              Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 7              Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 8              Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 9              Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 10             Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 11             Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 12             Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 13             Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 14     Sánchez-Gonzalez et al. 2007        1</span></span>
<span><span class="co">## 15                 Pinus sylvestris        1</span></span>
<span><span class="co">## 16                           Q.ilex        1</span></span>
<span><span class="co">## 17                       Abies alba        1</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="taxonomic-harmonization">Taxonomic harmonization<a class="anchor" aria-label="anchor" href="#taxonomic-harmonization"></a>
</h2>
<p>Package <strong>traits4models</strong> currently relies on <a href="https://www.worldfloraonline.org/" class="external-link">World Flora Online</a> for
taxonomic harmonization, via package <strong>WorldFlora</strong> <span class="citation">(Kindt 2020)</span> available at <a href="https://cran.r-project.org/package=WorldFlora" class="external-link">CRAN</a>. This
latter package requires a static copy of the World Flora Online
Taxonomic Backbone data that can be downloaded from the <a href="https://www.worldfloraonline.org/" class="external-link">World Flora Online</a> website.
Note that you should use a different DOI reference when reporting your
harmonization procedures. We are using here <a href="https://doi.org/10.5281/zenodo.7460141" class="external-link">v.2024.06</a>. We assume
the user has already downloaded the backbone and stored it in a file
called <em>classification.csv</em>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WFO_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/OneDrive/mcaceres_work/model_development/medfate_parameterization/traits_and_models/"</span>, </span>
<span>                   <span class="st">"data-raw/wfo_backbone/classification.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Taxonomic harmonization is done by calling function
<code><a href="../reference/harmonize_taxonomy_WFO.html">harmonize_taxonomy_WFO()</a></code> with a data frame (where notation
and units are already harmonized) and the path to the WFO backbone (we
omit the console output):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_post</span> <span class="op">&lt;-</span> <span class="fu">traits4models</span><span class="fu">::</span><span class="fu"><a href="../reference/harmonize_taxonomy_WFO.html">harmonize_taxonomy_WFO</a></span><span class="op">(</span><span class="va">db_var</span>, <span class="va">WFO_file</span><span class="op">)</span></span></code></pre></div>
<p>The function requires that the input data frame contains a column
called <code>originalName</code>, to identify the original taxa names
(additional columns are simply transferred to the output). It performs
both direct and fuzzy matching, which may lead to large processing time
for large datasets. If we inspect the resulting data frame, we will see
the additional columns, informing about accepted names and parent
taxonomic entities:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">db_post</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       originalName     acceptedName acceptedNameAuthorship      family    genus</span></span>
<span><span class="co">## 1       Abies alba       Abies alba                  Mill.    Pinaceae    Abies</span></span>
<span><span class="co">## 2             Acer             Acer                     L. Sapindaceae     Acer</span></span>
<span><span class="co">## 3  Castanea sativa  Castanea sativa                  Mill.    Fagaceae Castanea</span></span>
<span><span class="co">## 4  Fagus sylvatica  Fagus sylvatica                     L.    Fagaceae    Fagus</span></span>
<span><span class="co">## 5         Fraxinus         Fraxinus           Tourn. ex L.    Oleaceae Fraxinus</span></span>
<span><span class="co">## 6 Pinus halepensis Pinus halepensis                  Mill.    Pinaceae    Pinus</span></span>
<span><span class="co">##   specificEpithet taxonRank         a      b             Equation   Response</span></span>
<span><span class="co">## 1            alba   species 1.0963648 0.5380 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 2            &lt;NA&gt;     genus 1.5189207 0.5285 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 3          sativa   species 1.3065630 0.5856 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 4       sylvatica   species 0.8386180 0.7347 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 5            &lt;NA&gt;     genus 1.1951838 0.5665 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">## 6      halepensis   species 0.6415296 0.7310 CrownWidth = a·DBH^b CrownWidth</span></span>
<span><span class="co">##   ResponseDescription Predictor1          PredictorDescription1</span></span>
<span><span class="co">## 1     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 2     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 3     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 4     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 5     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 6     Crown width (m)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">##                          Reference Priority</span></span>
<span><span class="co">## 1    Hasenauer (1997) - Abies alba        1</span></span>
<span><span class="co">## 2     Hasenauer (1997) - Acer spp.        1</span></span>
<span><span class="co">## 3             Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 4             Condés &amp; Sterba 2005        1</span></span>
<span><span class="co">## 5 Hasenauer (1997) - Fraxinus spp.        1</span></span>
<span><span class="co">## 6             Condés &amp; Sterba 2005        1</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="checking-harmonized-allometry-data">Checking harmonized allometry data<a class="anchor" aria-label="anchor" href="#checking-harmonized-allometry-data"></a>
</h2>
<p>The packages includes function
<code><a href="../reference/check_harmonized_trait.html">check_harmonized_allometry()</a></code> to check whether a given data
frame conforms in structure and content to what is later required for
parameter table filling:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_harmonized_trait.html">check_harmonized_allometry</a></span><span class="op">(</span><span class="va">db_post</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Column 'DOI' should preferably be defined.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> The data frame is acceptable as harmonized allometry data source.</span></span></code></pre>
<p>In this case, the data set is ready to be used in parameter
estimation. As an example, we can run the same checking function with
the data base before taxonomic harmonization:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_harmonized_trait.html">check_harmonized_allometry</a></span><span class="op">(</span><span class="va">db_var</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #BBBB00;">!</span> Required columns missing: acceptedName acceptedNameAuthorship family genus specificEpithet taxonRank</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Column 'DOI' should preferably be defined.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #BBBB00;">!</span> The data frame is not acceptable as harmonized allometry data source.</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="storing-harmonized-dataset">Storing harmonized dataset<a class="anchor" aria-label="anchor" href="#storing-harmonized-dataset"></a>
</h2>
<p>Harmonized data tables can be stored in <strong>.csv</strong> text
format or compressed <strong>.rds</strong> format.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv2</a></span><span class="op">(</span><span class="va">db_post</span>, <span class="st">"Products/harmonized/tree_crown_width_europe.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Note that all tables should be stored in the same directory, here in
the <code>Products/harmonized/</code> path, for populate model
parameters.</p>
</div>
<div class="section level2">
<h2 id="accessing-harmonized-allometry-data">Accessing harmonized allometry data<a class="anchor" aria-label="anchor" href="#accessing-harmonized-allometry-data"></a>
</h2>
<div class="section level3">
<h3 id="list-of-harmonized-allometry-databases">List of harmonized allometry databases<a class="anchor" aria-label="anchor" href="#list-of-harmonized-allometry-databases"></a>
</h3>
<p>As mentioned in the introduction, here it is assumed that a set of
plant allometry databases have been harmonized. In our case, harmonized
data files have been stored in the following path:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonized_allometry_path</span> <span class="op">=</span> <span class="st">"~/OneDrive/EMF_datasets/AllometryDatabases/Products/harmonized"</span></span></code></pre></div>
<p>We can list the set of harmonized sources using:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allometry_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">harmonized_allometry_path</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">allometry_files</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "shrub_crown_area_catalonia.csv"                  </span></span>
<span><span class="co">##  [2] "shrub_fine_fuel_biomass_catalonia.csv"           </span></span>
<span><span class="co">##  [3] "shrub_total_biomass_catalonia.csv"               </span></span>
<span><span class="co">##  [4] "tree_bark_thickness_catalonia.csv"               </span></span>
<span><span class="co">##  [5] "tree_crown_ratio_europe.csv"                     </span></span>
<span><span class="co">##  [6] "tree_crown_width_europe.csv"                     </span></span>
<span><span class="co">##  [7] "tree_foliar_biomass_calvoalvarado_et_al_2024.csv"</span></span>
<span><span class="co">##  [8] "tree_foliar_biomass_catalonia.csv"               </span></span>
<span><span class="co">##  [9] "tree_foliar_biomass_eslamdoust_et_al_2017.csv"   </span></span>
<span><span class="co">## [10] "tree_foliar_biomass_thom_et_al_2024.csv"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="querying-allometry-data-for-particular-response-variable">Querying allometry data for particular response variable<a class="anchor" aria-label="anchor" href="#querying-allometry-data-for-particular-response-variable"></a>
</h3>
<p>Before filling any species parameter table, it may be useful to
inspect the amount of information available for particular response.
Package <strong>trait4models</strong> provides function
<code><a href="../reference/get_trait_data.html">get_allometry_data()</a></code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trait_data.html">get_allometry_data</a></span><span class="op">(</span><span class="va">harmonized_allometry_path</span>, <span class="st">"FoliarBiomass"</span>,</span>
<span>                              progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fb_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              originalName           acceptedName acceptedNameAuthorship</span></span>
<span><span class="co">## 1 Tetragastris panamensis    Protium stevensonii         (Standl.) Daly</span></span>
<span><span class="co">## 2         Virola koschnii        Virola koschnyi                  Warb.</span></span>
<span><span class="co">## 3       Carapa guianensis      Carapa guianensis                  Aubl.</span></span>
<span><span class="co">## 4     Vochysia ferruginea    Vochysia ferruginea                  Mart.</span></span>
<span><span class="co">## 5  Pentaclethra macroloba Pentaclethra macroloba        (Willd.) Kuntze</span></span>
<span><span class="co">## 6              Abies alba             Abies alba                  Mill.</span></span>
<span><span class="co">##          family        genus specificEpithet taxonRank</span></span>
<span><span class="co">## 1   Burseraceae      Protium     stevensonii   species</span></span>
<span><span class="co">## 2 Myristicaceae       Virola        koschnyi   species</span></span>
<span><span class="co">## 3     Meliaceae       Carapa      guianensis   species</span></span>
<span><span class="co">## 4  Vochysiaceae     Vochysia      ferruginea   species</span></span>
<span><span class="co">## 5      Fabaceae Pentaclethra       macroloba   species</span></span>
<span><span class="co">## 6      Pinaceae        Abies            alba   species</span></span>
<span><span class="co">##                                         Equation         a        b</span></span>
<span><span class="co">## 1                        FoliarBiomass = a·DBH^b 0.0400000 1.737000</span></span>
<span><span class="co">## 2                        FoliarBiomass = a·DBH^b 0.0020000 2.468000</span></span>
<span><span class="co">## 3                        FoliarBiomass = a·DBH^b 0.0120000 2.089000</span></span>
<span><span class="co">## 4                        FoliarBiomass = a·DBH^b 0.6730000 1.058000</span></span>
<span><span class="co">## 5                        FoliarBiomass = a·DBH^b 0.9580000 0.757000</span></span>
<span><span class="co">## 6 FoliarBiomass = a·DBH^b·exp(c·BAL)·DBH^(d·BAL) 0.1231138 1.452404</span></span>
<span><span class="co">##                                                                                                                                                                                                  Reference</span></span>
<span><span class="co">## 1 Calvo-Alvarado et al. (2008) Allometric relationships predicting foliar biomass and leaf area:sapwood area ratio from tree height in five Costa Rican rain forest species. Tree Physiology 28: 1601-1608</span></span>
<span><span class="co">## 2 Calvo-Alvarado et al. (2008) Allometric relationships predicting foliar biomass and leaf area:sapwood area ratio from tree height in five Costa Rican rain forest species. Tree Physiology 28: 1601-1608</span></span>
<span><span class="co">## 3 Calvo-Alvarado et al. (2008) Allometric relationships predicting foliar biomass and leaf area:sapwood area ratio from tree height in five Costa Rican rain forest species. Tree Physiology 28: 1601-1608</span></span>
<span><span class="co">## 4 Calvo-Alvarado et al. (2008) Allometric relationships predicting foliar biomass and leaf area:sapwood area ratio from tree height in five Costa Rican rain forest species. Tree Physiology 28: 1601-1608</span></span>
<span><span class="co">## 5 Calvo-Alvarado et al. (2008) Allometric relationships predicting foliar biomass and leaf area:sapwood area ratio from tree height in five Costa Rican rain forest species. Tree Physiology 28: 1601-1608</span></span>
<span><span class="co">## 6                                                                                                                                                                                          Calculated IEFC</span></span>
<span><span class="co">##        Response ResponseDescription Predictor1          PredictorDescription1</span></span>
<span><span class="co">## 1 FoliarBiomass Foliar biomass (kg)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 2 FoliarBiomass Foliar biomass (kg)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 3 FoliarBiomass Foliar biomass (kg)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 4 FoliarBiomass Foliar biomass (kg)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 5 FoliarBiomass Foliar biomass (kg)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">## 6 FoliarBiomass Foliar biomass (kg)        DBH Diameter at breast height (cm)</span></span>
<span><span class="co">##   Priority  c  d Predictor2              PredictorDescription2</span></span>
<span><span class="co">## 1        2 NA NA       &lt;NA&gt;                               &lt;NA&gt;</span></span>
<span><span class="co">## 2        2 NA NA       &lt;NA&gt;                               &lt;NA&gt;</span></span>
<span><span class="co">## 3        2 NA NA       &lt;NA&gt;                               &lt;NA&gt;</span></span>
<span><span class="co">## 4        2 NA NA       &lt;NA&gt;                               &lt;NA&gt;</span></span>
<span><span class="co">## 5        2 NA NA       &lt;NA&gt;                               &lt;NA&gt;</span></span>
<span><span class="co">## 6        1  0  0        BAL Basal area of larger trees (m2/ha)</span></span></code></pre>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-kindt_worldflora_2020" class="csl-entry">
Kindt, Roeland. 2020. <span>“<span>WorldFlora</span>: <span>An</span>
<span>R</span> Package for Exact and Fuzzy Matching of Plant Names
Against the <span>World</span> <span>Flora</span> <span>Online</span>
Taxonomic Backbone Data.”</span> <em>Applications in Plant Sciences</em>
8 (9): e11388. <a href="https://doi.org/10.1002/aps3.11388" class="external-link">https://doi.org/10.1002/aps3.11388</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Martin-StPaul, Adriana Tovar, Víctor Granda.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
